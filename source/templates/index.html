<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa Interativo</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        #map {
            height: 500px;
            width: 80%;
            margin: 20px auto;
        }
        select {
            padding: 10px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <h1>Selecione um Estado do Brasil</h1>
    <select id="estadoSelect">
        <option value="">Selecione um estado</option>
    </select>
    <div id="map"></div>

    <script>
        let map = L.map('map').setView([-14.2350, -51.9253], 4);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        let estadoLayer;

        fetch('/estados')
            .then(response => response.json())
            .then(data => {
                let select = document.getElementById('estadoSelect');
                data.estados.forEach(estado => {
                    let option = document.createElement('option');
                    option.value = estado;
                    option.textContent = estado;
                    select.appendChild(option);
                });
            });

        document.getElementById('estadoSelect').addEventListener('change', function() {
            let estado = this.value;
            if (estado) {
                fetch(`/estado?nome=${estado}`)
                    .then(response => response.json())
                    .then(data => {
                        if (estadoLayer) {
                            map.removeLayer(estadoLayer);
                        }
                        estadoLayer = L.geoJSON(JSON.parse(data.geojson), {
                            style: { color: 'red', weight: 2 }
                        }).addTo(map);
                        map.fitBounds(estadoLayer.getBounds());
                    });
            }
        });
    </script>
</body>
</html>
